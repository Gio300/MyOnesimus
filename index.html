<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4a6fa5">
    <link rel="manifest" href="manifest.json">
    <title>JW Assistant</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main App Container -->
    <div id="app">
        <!-- Header -->
        <header id="app-header">
            <h1 id="header-title">JW Assistant</h1>
            <div id="header-controls">
                <button id="settings-btn" class="icon-btn settings-btn" title="Settings" onclick="showSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                </button>
                <select id="bible-version-selector" title="Select Bible Version">
                    <option value="nwt">NWT</option>
                    <option value="kjv">KJV</option>
                    <option value="asv">ASV</option>
                    <option value="eth">Ethiopian</option>
                </select>
                <div id="header-status">
                    <span id="connection-status" class="status-dot offline"></span>
                    <span id="ai-status">AI Ready</span>
                </div>
            </div>
        </header>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="modal-close" onclick="closeSettings()">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Groq API Key (Optional - for full AI)</label>
                        <input type="password" id="groq-api-input" placeholder="gsk_...">
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                            Get free key at: console.groq.com
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="control-btn" onclick="closeSettings()">Cancel</button>
                    <button class="control-btn primary" onclick="saveSettings()">Save</button>
                </div>
            </div>
        </div>

        <!-- Tab Content Container -->
        <main id="tab-content">
            
            <!-- CHAT TAB -->
            <div id="chat-tab" class="tab-panel active">
                <div id="chat-controls">
                    <div id="chat-mode-toggle">
                        <button id="mode-ai" class="mode-btn active">AI + Scriptures</button>
                        <button id="mode-scripture" class="mode-btn">Scriptures Only</button>
                    </div>
                    <button id="toggle-floating-meta-btn" class="icon-btn meta-float-btn" title="Toggle Meta Mode Overlay">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                        </svg>
                    </button>
                    <button id="recycle-chat-btn" class="icon-btn recycle-btn" title="Clear Chat">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12z"/>
                        </svg>
                    </button>
                </div>
                <div id="chat-messages" class="chat-container">
                    <div class="welcome-message">
                        <h2>Welcome to JW Assistant</h2>
                        <p>Ask me about scriptures, Bible topics, or ministry guidance.</p>
                        <div class="quick-actions">
                            <button class="quick-btn" onclick="quickAsk('What does the Bible say about love?')">Bible Topics</button>
                            <button class="quick-btn" onclick="quickAsk('Show me scriptures about faith')">Find Scriptures</button>
                            <button class="quick-btn" onclick="quickAsk('Help me prepare a talk')">Prepare Talk</button>
                        </div>
                    </div>
                </div>
                
                <div id="chat-input-container">
                    <button id="voice-input-btn" class="icon-btn" title="Voice Input">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                        </svg>
                    </button>
                    <textarea id="chat-input" placeholder="Ask a question or request scriptures..." rows="1"></textarea>
                    <button id="send-btn" class="icon-btn primary" title="Send">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- TELEPROMPTER TAB -->
            <div id="teleprompter-tab" class="tab-panel">
                <div id="teleprompter-controls">
                    <button id="tp-edit-btn" class="control-btn">Edit</button>
                    <div class="tp-playback-controls">
                        <button id="tp-backward-btn" class="control-btn" title="Back 5 sentences">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>
                            </svg>
                        </button>
                        <button id="tp-play-btn" class="control-btn primary">▶ Start</button>
                        <button id="tp-pause-btn" class="control-btn hidden">⏸ Pause</button>
                        <button id="tp-forward-btn" class="control-btn" title="Forward 5 sentences">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="speed-control">
                        <label>Speed:</label>
                        <input type="range" id="tp-speed" min="1" max="10" value="5">
                    </div>
                    <button id="tp-clear-btn" class="control-btn danger">Clear</button>
                </div>
                
                <div id="teleprompter-editor" class="tp-editor hidden">
                    <textarea id="tp-text-input" placeholder="Write your talk, paste scriptures, or ask AI to prepare content...

Example:
Title: Faith Moves Mountains

Opening: Matthew 17:20
Main Points:
1. What is faith? (Hebrews 11:1)
2. Examples of faith (Hebrews 11)
3. Building our faith (Romans 10:17)

Conclusion: James 2:26"></textarea>
                    <div class="editor-actions">
                        <button id="tp-save-btn" class="control-btn primary">Save to Teleprompter</button>
                        <button id="tp-cancel-btn" class="control-btn">Cancel</button>
                    </div>
                </div>
                
                <div id="teleprompter-display" class="tp-display">
                    <div id="tp-content" class="tp-content">
                        <p class="tp-empty">No content loaded. Click 'Edit' to add your talk or Bible reading.</p>
                    </div>
                </div>
            </div>

            <!-- META MODE TAB -->
            <div id="meta-tab" class="tab-panel">
                <div id="meta-header">
                    <div class="meta-status">
                        <div class="listening-indicator">
                            <span class="pulse"></span>
                            <span>Listening...</span>
                        </div>
                        <div class="gps-indicator" id="gps-status">
                            <span class="gps-dot"></span>
                            <span id="gps-text">GPS Tracking</span>
                        </div>
                        <p class="meta-hint">Meta Mode tracks conversation topics and your route automatically.</p>
                    </div>
                </div>
                
                <div id="meta-location-summary" class="location-summary hidden">
                    <div class="location-info">
                        <span class="location-icon">📍</span>
                        <div class="location-details">
                            <div id="current-address">Getting location...</div>
                            <div id="location-stats">0 locations tracked</div>
                        </div>
                    </div>
                </div>
                
                <div id="meta-suggestions" class="meta-container">
                    <div class="meta-welcome">
                        <h3>🎯 Meta Mode Active</h3>
                        <p>I'll listen to conversations and suggest scriptures showing JW views.</p>
                        <p>Your route is being tracked automatically for field service records.</p>
                        <p class="note">Speak naturally. I'll display relevant scriptures without interrupting.</p>
                    </div>
                </div>
                
                <div id="meta-history" class="meta-history">
                    <button id="auto-note-btn" class="control-btn success">🤖 Auto Note</button>
                    <button id="convert-to-note-btn" class="control-btn primary">Convert to Note</button>
                    <button id="clear-meta-btn" class="control-btn small">Clear History</button>
                </div>
            </div>

            <!-- Floating Meta Mode Overlay -->
            <div id="floating-meta" class="floating-meta hidden">
                <div class="floating-meta-header">
                    <span class="floating-meta-title">🎯 Meta Mode</span>
                    <button class="floating-meta-close" onclick="toggleFloatingMeta()">×</button>
                </div>
                <div id="floating-meta-suggestions" class="floating-meta-body">
                    <p class="floating-meta-hint">Listening for conversation topics...</p>
                </div>
            </div>

            <!-- NOTES TAB -->
            <div id="notes-tab" class="tab-panel">
                <div id="notes-header">
                    <button id="new-note-btn" class="control-btn primary">+ New Note</button>
                    <div class="notes-search-container">
                        <input type="search" id="notes-search" placeholder="Search notes with AI...">
                        <button id="ai-search-btn" class="icon-btn small" title="AI Search">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div id="notes-list" class="notes-container">
                    <div class="notes-empty">
                        <p>No notes yet. Start recording your field service experiences!</p>
                        <button onclick="showNoteEditor()" class="control-btn primary">Create First Note</button>
                    </div>
                </div>
                
                <!-- Note Editor Modal -->
                <div id="note-editor" class="note-editor hidden">
                    <div class="note-editor-content">
                        <h3 id="editor-title">New Field Service Note</h3>
                        
                        <div class="form-group">
                            <label>Person/Location</label>
                            <input type="text" id="note-person" placeholder="Name or address...">
                        </div>
                        
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="note-datetime">
                        </div>
                        
                        <div class="form-group">
                            <label>Conversation Notes</label>
                            <textarea id="note-content" rows="6" placeholder="What did you discuss? Which scriptures did you share? Any publications placed?"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Tags</label>
                            <div class="tag-buttons">
                                <button class="tag-btn" data-tag="interested">Interested</button>
                                <button class="tag-btn" data-tag="not-home">Not Home</button>
                                <button class="tag-btn" data-tag="return-visit">Return Visit</button>
                                <button class="tag-btn" data-tag="do-not-call">Do Not Call</button>
                                <button class="tag-btn" data-tag="study">Bible Study</button>
                            </div>
                            <input type="text" id="note-tags" placeholder="Selected tags will appear here...">
                        </div>
                        
                        <div class="form-group">
                            <label>Follow-up Date</label>
                            <input type="date" id="note-followup">
                        </div>
                        
                        <div class="form-group">
                            <label>Photo</label>
                            <input type="file" id="note-photo" accept="image/*" capture="environment">
                            <div id="photo-preview"></div>
                        </div>
                        
                        <div class="editor-actions">
                            <button id="save-note-btn" class="control-btn primary">Save Note</button>
                            <button id="cancel-note-btn" class="control-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav id="bottom-nav">
            <button class="nav-btn active" data-tab="chat">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                </svg>
                <span>Chat</span>
            </button>
            
            <button class="nav-btn" data-tab="teleprompter">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                <span>Teleprompter</span>
            </button>
            
            <button class="nav-btn" data-tab="meta">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
                <span>Meta Mode</span>
            </button>
            
            <button class="nav-btn" data-tab="notes">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
                <span>Notes</span>
            </button>
        </nav>
    </div>

    <!-- Scripture Detail Modal -->
    <div id="scripture-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="scripture-modal-title">Scripture Reference</h3>
                <button class="modal-close" onclick="closeScriptureModal()">×</button>
            </div>
            <div class="modal-body" id="scripture-modal-body">
                <div class="scripture-text-section">
                    <h4>Text</h4>
                    <p id="scripture-text" class="scripture-full-text"></p>
                </div>
                <div class="cross-references-section">
                    <h4>Cross-References</h4>
                    <div id="cross-references-list"></div>
                </div>
                <div class="study-notes-section">
                    <h4>Study Notes</h4>
                    <div id="study-notes-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="control-btn" onclick="shareScripture()">Share</button>
                <button class="control-btn primary" onclick="closeScriptureModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="bible_data.js"></script>
    <script src="app.js"></script>
</body>
</html>

